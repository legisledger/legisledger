{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Legis Ledger Core Knowledge Schema (Domain-Agnostic)",
  "description": "Universal schema for structured knowledge claims with Bayesian confidence and provenance transparency. Works across legal, scientific, and policy domains.",
  "version": "1.1.0",
  "type": "object",
  
  "required": [
    "@context",
    "@type",
    "identifier",
    "scenario",
    "conclusion",
    "evidenceBasis",
    "bayesianAnalysis",
    "sources",
    "metadata",
    "disclaimer"
  ],
  
  "properties": {
    "@context": {
      "oneOf": [
        {"type": "string"},
        {"type": "array", "items": {"type": ["string", "object"]}}
      ],
      "description": "JSON-LD context for semantic web compatibility"
    },
    
    "@type": {
      "type": "string",
      "enum": ["KnowledgeClaim", "LegalRightKnowledge", "ScientificKnowledge", "PolicyKnowledge"],
      "description": "Type of knowledge claim. Base type is KnowledgeClaim; domain-specific types inherit from it."
    },
    
    "identifier": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique identifier (kebab-case). Format: domain-topic-variant (e.g., 'climate-co2-warming-ipcc-2025', 'creatine-cognitive-function-2025')"
    },
    
    "scenario": {
      "type": "object",
      "required": ["description", "domain"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Plain language description of the claim or situation being analyzed"
        },
        "domain": {
          "type": "string",
          "enum": ["legal", "scientific", "policy", "medical", "economic"],
          "description": "Knowledge domain. Determines which extensions apply."
        },
        "parameters": {
          "type": "object",
          "description": "Domain-specific parameters. Structure varies by domain.",
          "additionalProperties": true,
          "examples": [
            {
              "legal": {
                "jurisdiction": "EU",
                "issueType": "flight-delay",
                "delayHours": 4
              }
            },
            {
              "scientific": {
                "intervention": "creatine monohydrate 3-5g/day",
                "population": "sleep-deprived adults",
                "outcome": "cognitive performance"
              }
            }
          ]
        }
      },
      "description": "Defines the scope and context of the knowledge claim. This is the AI-ready protocol bridge between conversational interfaces and structured knowledge."
    },
    
    "conclusion": {
      "type": "object",
      "required": ["claim", "confidence"],
      "properties": {
        "claim": {
          "type": "string",
          "description": "The specific assertion being made (e.g., 'Passenger is entitled to compensation', 'CO₂ causes warming', 'Creatine improves cognitive function')"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 0.999,
          "description": "Bayesian posterior probability (0-0.999). MUST be <1.0 (epistemic humility enforced structurally). Even canonical knowledge (0.999) acknowledges possibility of error."
        },
        "confidenceInterval": {
          "type": "array",
          "items": {"type": "number", "minimum": 0, "maximum": 1},
          "minItems": 2,
          "maxItems": 2,
          "description": "95% confidence interval [lower, upper]. Quantifies uncertainty around point estimate."
        },
        "outcome": {
          "type": "object",
          "description": "Domain-specific outcome details",
          "additionalProperties": true,
          "examples": [
            {"legal": {"remedy": "€600 compensation", "basis": "EU Reg 261/2004"}},
            {"scientific": {"effectSize": "small-to-moderate (d ≈ 0.3-0.5)", "clinicalSignificance": "uncertain"}}
          ]
        },
        "uncertainties": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Explicit list of what could make this conclusion wrong. Required for epistemic honesty."
        },
        "couldBeWrong": {
          "type": "object",
          "properties": {
            "probability": {
              "type": "number", 
              "description": "1 - confidence. The probability this conclusion is incorrect."
            },
            "reasons": {
              "type": "array", 
              "items": {"type": "string"},
              "description": "Specific reasons why this conclusion might be wrong"
            }
          },
          "description": "Explicit acknowledgment of fallibility. Makes uncertainty concrete for users."
        }
      },
      "description": "The expert judgment with quantified uncertainty"
    },
    
    "evidenceBasis": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["type", "citation"],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "regulation", "statute", "treaty", "case-law", "administrative-rule",
              "peer-reviewed-study", "meta-analysis", "systematic-review", "rct",
              "observational-study", "experimental-data", "theoretical-model",
              "expert-consensus", "historical-record", "mechanistic-study"
            ],
            "description": "Type of evidence"
          },
          "citation": {
            "type": "string",
            "description": "Formal citation in appropriate style (legal: Bluebook/ECLI; scientific: APA/Vancouver)"
          },
          "summary": {
            "type": "string",
            "description": "Plain language: Why this evidence matters"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "Link to source (full text if available)"
          },
          "authority": {
            "type": "string",
            "enum": ["binding", "persuasive", "authoritative", "preliminary"],
            "description": "Weight of this evidence (legal domain)"
          },
          "grade": {
            "type": "string",
            "enum": ["A+", "A", "B", "C", "D"],
            "description": "Evidence quality grade (scientific domain). A+ = meta-analysis, A = RCT, B = mechanistic, C = preliminary, D = anecdotal"
          },
          "datePublished": {
            "type": "string",
            "format": "date",
            "description": "When this evidence was established"
          },
          "doi": {
            "type": "string",
            "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Z0-9]+$",
            "description": "DOI if applicable (for scientific papers)"
          },
          "industryFunding": {
            "type": "boolean",
            "description": "Whether study received industry funding (scientific domain). Transparency about potential conflicts."
          }
        }
      },
      "description": "The foundational evidence supporting the conclusion. All evidence must be graded/weighted for transparency."
    },
    
    "bayesianAnalysis": {
      "type": "object",
      "required": ["prior", "posterior"],
      "properties": {
        "prior": {
          "type": "object",
          "required": ["confidence", "basis"],
          "properties": {
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Starting confidence before examining specific evidence"
            },
            "basis": {
              "type": "string",
              "description": "Why this prior? (base rates, theoretical prediction, expert consensus, mechanistic plausibility)"
            },
            "source": {
              "type": "string",
              "description": "Where does this prior come from? (historical data, first-principles reasoning, domain expertise)"
            }
          }
        },
        "evidence": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["factor", "posteriorAfter"],
            "properties": {
              "factor": {
                "type": "string",
                "description": "Evidence considered in this update step"
              },
              "increases": {
                "type": "boolean",
                "description": "Does this evidence increase or decrease confidence?"
              },
              "posteriorAfter": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Confidence after incorporating this evidence"
              },
              "bayesFactor": {
                "type": "number",
                "minimum": 0,
                "description": "Strength of evidence: P(E|H) / P(E|¬H). >1 supports hypothesis, <1 contradicts, =1 neutral"
              },
              "reasoning": {
                "type": "string",
                "description": "Why this evidence changes confidence (plain language explanation)"
              }
            }
          },
          "description": "Sequential Bayesian updates. Each piece of evidence produces a new posterior, which becomes the prior for the next update."
        },
        "posterior": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Final confidence after all evidence. MUST match conclusion.confidence"
        },
        "howToChangeMyMind": {
          "type": "array",
          "items": {"type": "string"},
          "description": "What evidence would falsify this conclusion? (Popper's falsifiability criterion). Critical for epistemic honesty."
        }
      },
      "description": "Transparent Bayesian reasoning path from prior to posterior. Shows users WHY the confidence is what it is."
    },
    
    "sources": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["citation"],
        "properties": {
          "type": {
            "type": "string",
            "description": "Type of source (regulation, peer-reviewed-study, government-guidance, etc.)"
          },
          "citation": {
            "type": "string",
            "description": "Full citation"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "Link to source"
          },
          "accessDate": {
            "type": "string",
            "format": "date",
            "description": "When this source was accessed"
          },
          "quality": {
            "type": "string",
            "enum": ["primary", "secondary", "tertiary"],
            "description": "Source quality tier"
          },
          "doi": {
            "type": "string",
            "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Z0-9]+$",
            "description": "DOI if applicable (for scientific papers)"
          }
        }
      },
      "description": "All sources consulted. Enables verification and provenance tracking."
    },
    
    "metadata": {
      "type": "object",
      "required": ["submittedBy", "funnelPosition", "version"],
      "properties": {
        "submittedBy": {
          "type": "object",
          "required": ["institution", "institutionType"],
          "properties": {
            "institution": {
              "type": "string",
              "description": "Name of submitting institution (e.g., 'IPCC Working Group I', 'Passenger Rights Knowledge Base Project')"
            },
            "institutionType": {
              "type": "string",
              "enum": [
                "government-agency",
                "independent-research",
                "independent-educational",
                "academic-institution",
                "professional-association",
                "industry-group",
                "advocacy-organization"
              ],
              "description": "Type of institution. Critical for users to understand potential biases."
            },
            "authorName": {
              "type": "string",
              "description": "Primary author (optional)"
            },
            "authorORCID": {
              "type": "string",
              "pattern": "^\\d{4}-\\d{4}-\\d{4}-\\d{3}[0-9X]$",
              "description": "ORCID identifier for author (scientific domain)"
            },
            "role": {
              "type": "string",
              "description": "Author's role (e.g., 'Lead researcher', 'Legal analyst')"
            }
          },
          "description": "Who submitted this knowledge claim. Required for provenance transparency."
        },
        "submissionDate": {
          "type": "string",
          "format": "date-time"
        },
        "acceptedDate": {
          "type": "string",
          "format": "date-time"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic versioning (major.minor.patch)"
        },
        "gitCommit": {
          "type": "string",
          "description": "Git commit hash for immutable provenance"
        },
        "funnelPosition": {
          "type": "string",
          "enum": ["wide-end-speculation", "middle-funnel-testing", "narrow-end-confirmed", "narrow-end-canonical"],
          "description": "Position in Rauch's validation funnel. Maps to confidence ranges: speculation (0.20-0.50), testing (0.50-0.70), confirmed (0.70-0.90), canonical (0.90-0.999)"
        },
        "funnelJustification": {
          "type": "string",
          "description": "Why this funnel position? (years in force, replication count, consensus level, enforcement history)"
        },
        "reviewSchedule": {
          "type": "string",
          "description": "When this should be reviewed (e.g., 'quarterly', 'annual', 'when regulation changes', 'when new RCTs published')"
        },
        "changelog": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "date": {"type": "string", "format": "date"},
              "version": {"type": "string"},
              "changes": {"type": "string"}
            }
          }
        }
      },
      "description": "Governance metadata. Infrastructure adds this; institutions submit their expert opinion."
    },
    
    "validation": {
      "type": "object",
      "description": "Real-world validation tracking. Structure varies by domain but follows same principle: track outcomes.",
      "properties": {
        "replicationStatus": {
          "type": "object",
          "description": "Scientific domain: track replication attempts",
          "properties": {
            "totalStudies": {"type": "integer"},
            "supportingStudies": {"type": "integer"},
            "contradictingStudies": {"type": "integer"},
            "mixedResults": {"type": "integer"},
            "replicationRate": {"type": "number", "minimum": 0, "maximum": 1}
          }
        },
        "realWorldOutcomes": {
          "type": "object",
          "description": "Legal domain: track claim outcomes",
          "properties": {
            "claimsFiled": {"type": "integer"},
            "compensationReceived": {"type": "integer"},
            "denied": {"type": "integer"},
            "actualSuccessRate": {"type": "number", "minimum": 0, "maximum": 1}
          }
        }
      },
      "additionalProperties": true
    },
    
    "relatedClaims": {
      "type": "object",
      "properties": {
        "supports": {
          "type": "array",
          "items": {"type": "string"},
          "description": "IDs of claims this evidence supports"
        },
        "contradicts": {
          "type": "array",
          "items": {"type": "string"},
          "description": "IDs of claims this contradicts"
        },
        "refines": {
          "type": "array",
          "items": {"type": "string"},
          "description": "IDs of earlier claims this updates/refines"
        },
        "requires": {
          "type": "array",
          "items": {"type": "string"},
          "description": "IDs of claims this depends on"
        }
      },
      "description": "Knowledge graph connections. Added by infrastructure."
    },
    
    "disclaimer": {
      "type": "object",
      "required": ["nature", "provenanceAndLimitations"],
      "properties": {
        "nature": {
          "type": "string",
          "enum": ["educational", "informational", "preliminary"],
          "description": "What kind of information is this?"
        },
        "notCertainty": {
          "type": "string",
          "description": "Standard epistemic humility disclaimer (e.g., '72% confidence means 28% chance wrong. Science is provisional.')"
        },
        "domainSpecific": {
          "type": "object",
          "description": "Domain-specific disclaimers (e.g., 'not legal advice', 'not medical advice')",
          "properties": {
            "notLegalAdvice": {"type": "boolean"},
            "notMedicalAdvice": {"type": "boolean"},
            "consultProfessional": {"type": "boolean"}
          },
          "additionalProperties": true
        },
        "provenanceAndLimitations": {
          "type": "object",
          "required": ["submittedBy", "notSubmittedByAuthority", "verificationStatus", "potentialBiases", "howToVerify", "updateMechanism", "transparencyCommitment"],
          "properties": {
            "submittedBy": {
              "type": "string",
              "description": "Who created this abstract (plain language, e.g., 'Independent research group')"
            },
            "notSubmittedByAuthority": {
              "oneOf": [
                {"type": "boolean"},
                {"type": "string"}
              ],
              "description": "Explicit statement that this was NOT submitted by official authority. Can be boolean or string explaining which authorities did NOT submit this."
            },
            "verificationStatus": {
              "type": "string",
              "description": "Has this been externally reviewed? (e.g., 'Unreviewed by external experts', 'Peer-reviewed by 3 scientists')"
            },
            "potentialBiases": {
              "type": "array",
              "items": {"type": "string"},
              "minItems": 1,
              "description": "Explicit list of potential biases. REQUIRED. Epistemic honesty demands acknowledging what could skew the analysis."
            },
            "howToVerify": {
              "type": "array",
              "items": {"type": "string"},
              "minItems": 1,
              "description": "Concrete steps users can take to verify this information independently. REQUIRED."
            },
            "strengthsOfThisAnalysis": {
              "type": "array",
              "items": {"type": "string"},
              "description": "What makes this analysis particularly reliable? (optional but recommended)"
            },
            "weaknessesOfThisAnalysis": {
              "type": "array",
              "items": {"type": "string"},
              "description": "What are the limitations? (optional but recommended for complex cases)"
            },
            "specialConsiderations": {
              "type": "string",
              "description": "Case-specific context (e.g., 'Weather cases are fact-intensive', 'Long-term effects unknown')"
            },
            "updateMechanism": {
              "type": "string",
              "description": "How and when this gets updated (e.g., 'Quarterly review', 'When new RCTs published', 'When regulation changes')"
            },
            "transparencyCommitment": {
              "type": "string",
              "description": "Statement of commitment to transparency (e.g., 'All Bayesian reasoning disclosed', 'No hidden assumptions')"
            }
          },
          "description": "PROVENANCE TRANSPARENCY: The epistemic honesty section. Tell users who submitted this, what biases might exist, how to verify independently. REQUIRED in v1.1+"
        }
      },
      "description": "Legal/epistemic disclaimers. Required for epistemic honesty and user protection."
    }
  },

  "examples": [
    {
      "comment": "Scientific domain example (creatine)",
      "@type": "ScientificKnowledge",
      "identifier": "creatine-cognitive-sleep-deprivation-2025",
      "scenario": {
        "domain": "scientific",
        "description": "Does creatine supplementation improve cognitive function in sleep-deprived individuals?"
      },
      "conclusion": {
        "claim": "Creatine likely improves cognitive function in sleep-deprived individuals",
        "confidence": 0.72
      },
      "metadata": {
        "submittedBy": {
          "institution": "Independent Nutrition Research Collective",
          "institutionType": "independent-research"
        },
        "funnelPosition": "narrow-end-confirmed"
      },
      "disclaimer": {
        "nature": "educational",
        "provenanceAndLimitations": {
          "submittedBy": "Independent research group",
          "notSubmittedByAuthority": "NOT submitted by FDA, NIH, or medical authority",
          "potentialBiases": ["Some studies have industry funding", "Publication bias favors positive results"],
          "howToVerify": ["Search PubMed for RCTs", "Consult physician", "Review cited studies"]
        }
      }
    },
    {
      "comment": "Legal domain example (passenger rights)",
      "@type": "LegalRightKnowledge",
      "identifier": "eu-delay-mechanical-3hrs-2025",
      "scenario": {
        "domain": "legal",
        "description": "Flight from Paris to NYC delayed 4 hours due to mechanical issue"
      },
      "conclusion": {
        "claim": "Passenger entitled to €600 compensation",
        "confidence": 0.85
      },
      "metadata": {
        "submittedBy": {
          "institution": "Passenger Rights Knowledge Base Project",
          "institutionType": "independent-educational"
        },
        "funnelPosition": "narrow-end-canonical"
      },
      "disclaimer": {
        "nature": "educational",
        "domainSpecific": {
          "notLegalAdvice": true
        },
        "provenanceAndLimitations": {
          "submittedBy": "Independent educational project",
          "notSubmittedByAuthority": "NOT submitted by DGAC, EU Commission, or official enforcement body",
          "potentialBiases": ["May favor passenger interests due to project mission"],
          "howToVerify": ["Check official DGAC guidance", "Read EU Regulation 261/2004", "Consult attorney"]
        }
      }
    }
  ]
}
